<section id="agenda" class="section container">
  <h2><%= t(:agenda) %></h2>

  <% if dates.empty? %>
    <blockquote class="highline">
      <%= t(:agenda_description).html_safe %>
    </blockquote>
  <% else %>
    <% dates.each do |date| %>
      <h3 class="highline"><%= l(date) %></h3>
      <table class="table table-hover">
        <thead>
          <tr>
            <th></th>
            <% rooms.each do |room| %>
              <%= content_tag :th, room.name %>
            <% end %>
          </tr>
        </thead>

        <tbody>
          <% @event.schedules.where("DATE(occur_at) = ?", date).joins(:room).group_by(&:occur_at).keys.each do |datetime| %>
            <tr>
              <td><%= l(datetime.to_time) %></td>
              <% rooms.each do |room| %>
                <% item = @event.schedules.where("occur_at = ? AND room_id = ?", datetime, room.id).all.first %>
                <td>
                  <% if item %>
                    <%= link_to item.talk, "##{item.talk.parameterize}", :"data-toggle" => "modal" %><br>
                    (<%= [(link_to item.speaker1, "##{item.speaker1.name.parameterize}", :"data-toggle" => "modal" if item.speaker1), (link_to item.speaker2, "##{item.speaker2.name.parameterize}", :"data-toggle" => "modal" if item.speaker2)].compact.join(", ").html_safe %>)
                  <% else %>
                  -
                  <% end %>
                </td>
              <% end %>
            </tr>
          <% end %>
        <tbody>
      </table>
    <% end %>
  <% end %>
</section>
